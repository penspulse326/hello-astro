---
import ThemeToggler from './theme-toggler.astro';
---

<nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom">
  <div class="container">
    <!-- Brand -->
    <a class="navbar-brand me-4 d-lg-none" href="/">
      <img src="/logo.png" alt="Pen's Pulse 首頁" height="30" class="d-inline-block align-text-top" />
    </a>

    <!-- Desktop Navigation - only visible on lg and up -->
    <div class="collapse navbar-collapse" id="navbarMain">
      <div class="navbar-grid-container d-none d-lg-grid">
        <!-- Left Column: Navigation Links -->
        <div class="d-flex align-items-center">
          <!-- Brand -->
          <a class="navbar-brand me-4" href="/">
            <img src="/logo.png" alt="Pen's Pulse 首頁" height="30" class="d-inline-block align-text-top" />
          </a>
          <ul class="navbar-nav mb-0 d-flex flex-row gap-1">
            <li class="nav-item">
              <a class="nav-link" href="/notes">
                <span>研究筆記</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/challenges">
                <span>挑戰計畫</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/articles">
                <span>心得文章</span>
              </a>
            </li>
          </ul>
        </div>

        <!-- Center Column: Search Box -->
        <div class="d-flex justify-content-center align-items-center"></div>

        <!-- Right Column: External Links & Theme Toggle -->
        <div class="d-flex align-items-center justify-content-end">
          <div class="bd-search me-2">
            <button type="button" class="search-button" aria-label="搜尋 (Ctrl+K)">
              <div class="search-button-container">
                <i class="bi bi-search search-icon"></i>
                <span class="search-placeholder">搜尋</span>
              </div>
              <div class="search-keys">
                <kbd class="search-key">
                  <i class="bi bi-command" style="font-size: 0.8em;"></i>
                </kbd>
                <kbd class="search-key">K</kbd>
              </div>
            </button>
          </div>

          <a
            href="https://github.com/yourusername/yourrepo"
            target="_blank"
            rel="noopener noreferrer"
            class="text-body-emphasis text-opacity-75-hover px-2"
            aria-label="前往 GitHub 查看專案"
          >
            <span class="bi bi-github" style="font-size: 1.25rem;" aria-hidden="true"></span>
          </a>

          <ThemeToggler />
        </div>
      </div>
    </div>

    <!-- Mobile Menu Button - only visible on screens smaller than lg -->
    <button
      class="navbar-toggler px-1 border-0"
      type="button"
      data-bs-toggle="offcanvas"
      data-bs-target="#offcanvasNavbar"
      aria-controls="offcanvasNavbar"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Offcanvas Sidebar - only visible on mobile -->
    <div
      class="offcanvas offcanvas-end d-lg-none"
      tabindex="-1"
      id="offcanvasNavbar"
      aria-labelledby="offcanvasNavbarLabel"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title fw-bold" id="offcanvasNavbarLabel">Pen's Pulse</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>

      <hr class="mx-3 mt-0" />

      <div class="offcanvas-body">
        <!-- Internal Links in Two Columns -->
        <div class="row g-3">
          <div class="col-6 m-0">
            <a href="/notes" class="d-block py-2 text-decoration-none text-body">
              <div class="d-flex align-items-center">
                <span class="bi bi-journal-text me-2" aria-hidden="true"></span>
                <span>研究筆記</span>
              </div>
            </a>
          </div>
          <div class="col-6 m-0">
            <a href="/challenges" class="d-block py-2 text-decoration-none text-body">
              <div class="d-flex align-items-center">
                <span class="bi bi-trophy me-2" aria-hidden="true"></span>
                <span>挑戰計畫</span>
              </div>
            </a>
          </div>
          <div class="col-6 m-0">
            <a href="/articles" class="d-block py-2 text-decoration-none text-body">
              <div class="d-flex align-items-center">
                <span class="bi bi-file-earmark-text me-2" aria-hidden="true"></span>
                <span>心得文章</span>
              </div>
            </a>
          </div>
        </div>

        <hr class="my-3" />

        <!-- External Links -->
        <div class="row g-2">
          <div class="col-6 m-0">
            <a
              href="https://github.com/yourusername/yourrepo"
              target="_blank"
              rel="noopener noreferrer"
              class="d-block py-2 text-decoration-none text-body"
              aria-label="前往 GitHub 查看專案"
            >
              <div class="d-flex align-items-center">
                <span class="bi bi-github me-2" aria-hidden="true"></span>
                <span>GitHub</span>
              </div>
            </a>
          </div>
          <div class="col-6 m-0">
            <a
              href="https://example.com"
              target="_blank"
              rel="noopener noreferrer"
              class="d-block py-2 text-decoration-none text-body"
              aria-label="前往外部連結"
            >
              <div class="d-flex align-items-center">
                <span class="bi bi-box-arrow-up-right me-2" aria-hidden="true"></span>
                <span>外部連結</span>
              </div>
            </a>
          </div>
        </div>

        <hr class="my-3" />

        <!-- Theme Toggler -->
        <div
          class="d-flex align-items-center"
          style="cursor: pointer;"
          onclick="document.getElementById('bd-theme').click()"
        >
          <ThemeToggler />
          <span class="me-3">主題切換</span>
        </div>

        <hr class="my-3" />

        <!-- Search -->
        <div class="mt-3">
          <form role="search">
            <label for="mobile-search" class="visually-hidden">搜尋網站內容</label>
            <div class="input-group">
              <input
                type="search"
                id="mobile-search"
                class="form-control"
                placeholder="搜尋..."
                aria-label="搜尋網站內容"
              />
              <button class="btn btn-outline-secondary" type="submit" aria-label="執行搜尋">
                <span class="bi bi-search" aria-hidden="true"></span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</nav>

<style>
  /* Search button styles */
  .bd-search {
    position: relative;
    margin: 0;
  }

  .search-button {
    align-items: center;
    background-color: var(--bs-body-bg);
    border: 1px solid var(--bs-border-color);
    border-radius: 6px;
    color: var(--bs-body-color);
    display: flex;
    font-size: 0.875rem;
    font-weight: 400;
    height: 2rem;
    justify-content: space-between;
    min-width: 200px;
    padding: 0 0.5rem;
    text-align: left;
    transition: all 0.2s ease-in-out;
  }

  .search-button:hover {
    background-color: var(--bs-body-bg);
    border-color: var(--bs-primary);
    box-shadow: 0 0 0 3px rgb(var(--bs-primary-rgb), 0.1);
    color: var(--bs-body-color);
  }

  .search-button:focus {
    background-color: var(--bs-body-bg);
    border-color: var(--bs-primary);
    box-shadow: 0 0 0 3px rgb(var(--bs-primary-rgb), 0.25);
    color: var(--bs-body-color);
    outline: 0;
  }

  .search-button-container {
    align-items: center;
    display: flex;
    gap: 0.5rem;
    pointer-events: none;
  }

  .search-icon {
    color: var(--bs-secondary-color);
    flex-shrink: 0;
  }

  .search-placeholder {
    color: var(--bs-secondary-color);
    opacity: 0.75;
  }

  .search-keys {
    align-items: center;
    display: flex;
    gap: 0.25rem;
    pointer-events: none;
  }

  .search-key {
    align-items: center;
    background-color: var(--bs-tertiary-bg);
    border: 1px solid var(--bs-border-color);
    border-bottom: 2px solid var(--bs-gray-500);
    border-radius: 0.25rem;
    color: var(--bs-secondary-color);
    display: inline-flex;
    font-family: var(--bs-font-monospace);
    font-size: 1em;
    height: 1.5em;
    justify-content: center;
    line-height: 1.2;
    min-width: 1.2em;
    padding: 0 0.5em;
    white-space: nowrap;
  }

  .search-key-icon {
    color: var(--bs-secondary-color);
  }

  /* Grid layout for navbar - 3 columns with center column fixed width */
  .navbar-grid-container {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 1rem;
    width: 100%;
  }

  /* Navigation link hover effect */
  .nav-link span {
    position: relative;
    text-decoration: none;
    transition: all 0.15s ease;
    color: var(--bs-body-color);
  }

  .nav-link span::after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    bottom: -4px;
    left: 0;
    background-color: var(--bs-primary);
    transition: width 0.15s ease;
  }

  .nav-link:hover span::after {
    width: 100%;
  }

  /* Theme-aware colors for GitHub icon */
  [data-bs-theme='light'] .text-opacity-75-hover:hover {
    color: var(--bs-body-color) !important;
    opacity: 1 !important;
  }

  /* Smooth transitions for offcanvas */
  .offcanvas {
    transition: transform 0.3s ease-in-out;
  }

  /* Better spacing for mobile menu items */
  .offcanvas-body .nav-item {
    margin: 0.5rem 0;
  }

  /* Style for the offcanvas close button */
  .offcanvas-header .btn-close {
    margin: -0.5rem -0.5rem -0.5rem auto;
    padding: 0.5rem;
  }

  /* Custom styling for offcanvas links */
  .offcanvas-body a {
    border-radius: 0.375rem;
    transition: background-color 0.2s;
  }

  .offcanvas-body a:hover {
    background-color: rgb(0 0 0 / 5%);
  }

  [data-bs-theme='dark'] .offcanvas-body a:hover {
    background-color: rgb(255 255 255 / 10%);
  }

  [data-bs-theme='dark'] .text-opacity-75-hover {
    color: var(--bs-body-color) !important;
    opacity: 0.75;
  }

  [data-bs-theme='dark'] .text-opacity-75-hover:hover {
    opacity: 1;
  }
</style>
